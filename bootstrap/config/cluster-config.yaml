---
apiVersion: kind.x-k8s.io/v1alpha4
kind: Cluster
name: homelab
networking:
  podSubnet: 10.244.0.0/16
  serviceSubnet: 10.96.0.0/12
containerdConfigPatches:
  - |
    [plugins."io.containerd.grpc.v1.cri".registry.configs."registry-1.docker.io".auth]
      username = "__DOCKERHUB_USERNAME__"
      password = "__DOCKERHUB_PASSWORD__"
    [plugins."io.containerd.grpc.v1.cri".registry.configs."docker.io".auth]
      username = "__DOCKERHUB_USERNAME__"
      password = "__DOCKERHUB_PASSWORD__"
nodes:
  - role: control-plane
    image: &kind_node_image kindest/node:v1.34.0
    kubeadmConfigPatches:
      - |
        kind: ClusterConfiguration
        metadata:
          name: config
        apiServer:
          extraArgs:
            enable-admission-plugins: NodeRestriction
          certSANs:
            - localhost
            - 127.0.0.1
            - sc01.home.arpa
  - role: worker
    image: *kind_node_image
    extraMounts:
      - hostPath: /mnt/spool
        containerPath: /mnt/spool
      - hostPath: /mnt/dpool
        containerPath: /mnt/dpool
      - hostPath: /dev/ttyUSB0
        containerPath: /dev/ttyUSB0
      - hostPath: /dev/net/tun
        containerPath: /dev/net/tun
