---
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: EnvoyProxy
metadata:
  name: envoy-gateway-internal
  namespace: platform-system
spec:
  provider:
    type: Kubernetes
    kubernetes:
      useListenerPortAsContainerPort: true
      envoyDeployment:
        replicas: 1
        strategy:
          type: Recreate
        pod:
          annotations:
            k8s.v1.cni.cncf.io/networks: |-
              [
                {
                  "name": "lan-macvlan",
                  "namespace": "platform-system",
                  "ips": ["192.168.1.241/24"],
                  "mac": "02:42:c0:a8:01:f1",
                  "gateway": ["192.168.1.1"]
                }
              ]
        container:
          securityContext:
            capabilities:
              add:
                - NET_BIND_SERVICE
      envoyService:
        type: ClusterIP
  logging:
    level:
      default: info
