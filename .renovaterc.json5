{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",
  extends: [
    "config:recommended",
    ":semanticCommits",
    ":timezone(Europe/Warsaw)",
    ":prHourlyLimitNone",
    "docker:enableMajor",
  ],
  ignorePaths: ["**/*.sops.yaml", "**/*.sops.yml"],
  argocd: { managerFilePatterns: ["/^kubernetes/argocd/.*\\.ya?ml$/"] },
  customManagers: [
    {
      customType: "regex",
      description: "Track Kind node images referenced by bootstrap/config/cluster-config.yaml",
      managerFilePatterns: ["/^bootstrap/config/cluster-config\\.ya?ml$/"],
      matchStrings: [
        "image:\\s*(?:&\\S+\\s+)?(?<depName>kindest/node):(?<currentValue>[0-9A-Za-z_.\\-]+)",
      ],
      datasourceTemplate: "docker",
    },
  ],
  packageRules: [
    {
      description: "Require manual review for major upgrades",
      automerge: false,
      matchUpdateTypes: ["major"],
      addLabels: ["renovate/manual-review"],
    },
    {
      description: "Auto-merge all non-major dependency updates",
      automerge: true,
      automergeType: "branch",
      matchUpdateTypes: ["minor", "patch", "digest", "pin", "rollback"],
      ignoreTests: true,
    },
    {
      description: "Group Kind cluster node updates into a single PR",
      matchFileNames: ["bootstrap/config/cluster-config.yaml"],
      groupName: "kind-nodes",
    },
    {
      description: "Only consider semver Jellyfin tags",
      matchPackageNames: ["lscr.io/linuxserver/jellyfin"],
      allowedVersions: "/^(?:[0-9]|[1-9][0-9]).d+.d+$/",
    },
  ],
}
