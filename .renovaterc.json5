{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",
  extends: [
    "config:recommended",
    ":semanticCommits",
    ":timezone(Europe/Warsaw)",
    ":prHourlyLimitNone",
    "docker:enableMajor",
  ],
  ignorePaths: ["**/*.sops.yaml", "**/*.sops.yml"],
  customManagers: [
    {
      customType: "regex",
      description: "Track Kind node images in bootstrap/config/cluster-config.yaml",
      managerFilePatterns: ["/^bootstrap/config/cluster-config\\.ya?ml$/"],
      matchStrings: [
        "image:\\s*(?:&\\S+\\s+)?(?<depName>kindest/node):(?<currentValue>[0-9A-Za-z_.\\-]+)",
      ],
      datasourceTemplate: "docker",
    },
    {
      customType: "regex",
      description: "Track OCI Helm charts in apps/*/*/config.yaml (using path: .)",
      managerFilePatterns: ["/^apps\\/[^\\/]+\\/[^\\/]+\\/config\\.ya?ml$/"],
      matchStrings: [
        "repoURL:\\s*(?<registryUrl>oci://[^\\s]+)/(?<depName>[^/\\s]+)\\s+path:\\s*\\.\\s+targetRevision:\\s*(?<currentValue>\\S+)",
      ],
      datasourceTemplate: "helm",
      depNameTemplate: "{{{depName}}}",
    },
    {
      customType: "regex",
      description: "Track HTTPS Helm charts in apps/*/*/config.yaml (using chart:)",
      managerFilePatterns: ["/^apps\\/[^\\/]+\\/[^\\/]+\\/config\\.ya?ml$/"],
      matchStrings: [
        "repoURL:\\s*(?<registryUrl>https://[^\\s]+)\\s+chart:\\s*(?<depName>\\S+)\\s+targetRevision:\\s*(?<currentValue>\\S+)",
      ],
      datasourceTemplate: "helm",
    },
  ],
  packageRules: [
    {
      description: "Require manual review for major upgrades",
      automerge: false,
      matchUpdateTypes: ["major"],
      addLabels: ["renovate/manual-review"],
    },
    {
      description: "Auto-merge all non-major dependency updates",
      automerge: true,
      automergeType: "branch",
      matchUpdateTypes: ["minor", "patch", "digest", "pin", "rollback"],
      ignoreTests: true,
    },
    {
      description: "Group Kind cluster node updates into a single PR",
      matchFileNames: ["bootstrap/config/cluster-config.yaml"],
      groupName: "kind-nodes",
    },
    {
      description: "Only consider semver Jellyfin tags",
      matchPackageNames: ["lscr.io/linuxserver/jellyfin"],
      allowedVersions: "/^(?:[0-9]|[1-9][0-9])\\d+\\.\\d+$/",
    },
  ],
}
