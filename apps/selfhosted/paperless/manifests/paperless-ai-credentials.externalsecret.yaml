---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: paperless-ai-credentials
  namespace: selfhosted
spec:
  refreshInterval: 5m
  secretStoreRef:
    name: external-secrets-store
    kind: ClusterSecretStore
  target:
    name: paperless-ai-credentials
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        # .env file content (for file mount)
        .env: |
          PAPERLESS_API_URL=http://paperless.selfhosted.svc.cluster.local:8000/api
          PAPERLESS_API_TOKEN={{ .paperless_api_token }}
          PAPERLESS_USERNAME={{ .paperless_admin_user }}
          AI_PROVIDER=custom
          SCAN_INTERVAL=5 2 * * *
          SYSTEM_PROMPT=You are a document analysis AI for a multilingual user (English, Portuguese-BR, Polish). AVAILABLE TAGS (use ONLY these English tags): bank-statement, contract, employment, government, housing, insurance, invoice, legal, medical, payslip, receipt, shopping, subscription, tax, travel, user-manual, utilities. RULES: 1) Select tags ONLY from the list above - do NOT translate or create new tags. 2) For correspondents, use official/international company name. 3) Document_type must be in English (Invoice, Contract, Receipt, Letter, Bank Statement, etc). 4) Title: concise, in the ORIGINAL document language. 5) Dates: convert to YYYY-MM-DD format.
          PROCESS_PREDEFINED_DOCUMENTS=no
          TOKEN_LIMIT=128000
          RESPONSE_TOKENS=1000
          TAGS=
          ADD_AI_PROCESSED_TAG=no
          AI_PROCESSED_TAG_NAME=ai-processed
          USE_PROMPT_TAGS=no
          PROMPT_TAGS=
          USE_EXISTING_DATA=no
          CUSTOM_API_KEY={{ .paperless_ai_openai_api_key }}
          CUSTOM_BASE_URL=https://openrouter.ai/api/v1
          CUSTOM_MODEL=anthropic/claude-sonnet-4.5
          ACTIVATE_TAGGING=yes
          ACTIVATE_CORRESPONDENTS=yes
          ACTIVATE_DOCUMENT_TYPE=yes
          ACTIVATE_TITLE=yes
          ACTIVATE_CUSTOM_FIELDS=no
          CUSTOM_FIELDS={"custom_fields":[]}
          DISABLE_AUTOMATIC_PROCESSING=no
          RESTRICT_TO_EXISTING_TAGS=yes
          RESTRICT_TO_EXISTING_CORRESPONDENTS=no
          RESTRICT_TO_EXISTING_DOCUMENT_TYPES=no
          RAG_SERVICE_URL=http://localhost:8000
          RAG_SERVICE_ENABLED=true
          PAPERLESS_AI_INITIAL_SETUP=yes
          JWT_SECRET={{ .paperless_ai_jwt_secret }}
          AZURE_ENDPOINT=
          AZURE_API_KEY=
          AZURE_DEPLOYMENT_NAME=
          AZURE_API_VERSION=
        # Individual env vars (for envFrom)
        PAPERLESS_API_URL: http://paperless.selfhosted.svc.cluster.local:8000/api
        PAPERLESS_API_TOKEN: "{{ .paperless_api_token }}"
        PAPERLESS_USERNAME: "{{ .paperless_admin_user }}"
        AI_PROVIDER: custom
        SCAN_INTERVAL: 5 2 * * *
        SYSTEM_PROMPT: "You are a document analysis AI for a multilingual user (English, Portuguese-BR, Polish). AVAILABLE TAGS (use ONLY these English tags): bank-statement, contract, employment, government, housing, insurance, invoice, legal, medical, payslip, receipt, shopping, subscription, tax, travel, user-manual, utilities. RULES: 1) Select tags ONLY from the list above - do NOT translate or create new tags. 2) For correspondents, use official/international company name. 3) Document_type must be in English (Invoice, Contract, Receipt, Letter, Bank Statement, etc). 4) Title: concise, in the ORIGINAL document language. 5) Dates: convert to YYYY-MM-DD format."
        PROCESS_PREDEFINED_DOCUMENTS: "no"
        TOKEN_LIMIT: "128000"
        RESPONSE_TOKENS: "1000"
        TAGS: ""
        ADD_AI_PROCESSED_TAG: "no"
        AI_PROCESSED_TAG_NAME: ai-processed
        USE_PROMPT_TAGS: "no"
        PROMPT_TAGS: ""
        USE_EXISTING_DATA: "no"
        CUSTOM_API_KEY: "{{ .paperless_ai_openai_api_key }}"
        CUSTOM_BASE_URL: https://openrouter.ai/api/v1
        CUSTOM_MODEL: anthropic/claude-sonnet-4.5
        ACTIVATE_TAGGING: "yes"
        ACTIVATE_CORRESPONDENTS: "yes"
        ACTIVATE_DOCUMENT_TYPE: "yes"
        ACTIVATE_TITLE: "yes"
        ACTIVATE_CUSTOM_FIELDS: "no"
        CUSTOM_FIELDS: '{"custom_fields":[]}'
        DISABLE_AUTOMATIC_PROCESSING: "no"
        RESTRICT_TO_EXISTING_TAGS: "yes"
        RESTRICT_TO_EXISTING_CORRESPONDENTS: "no"
        RESTRICT_TO_EXISTING_DOCUMENT_TYPES: "no"
        RAG_SERVICE_URL: http://localhost:8000
        RAG_SERVICE_ENABLED: "true"
        PAPERLESS_AI_INITIAL_SETUP: "yes"
        JWT_SECRET: "{{ .paperless_ai_jwt_secret }}"
        AZURE_ENDPOINT: ""
        AZURE_API_KEY: ""
        AZURE_DEPLOYMENT_NAME: ""
        AZURE_API_VERSION: ""
  data:
    - secretKey: paperless_api_token
      remoteRef:
        key: paperless_api_token
    - secretKey: paperless_ai_openai_api_key
      remoteRef:
        key: paperless_ai_openai_api_key
    - secretKey: paperless_admin_user
      remoteRef:
        key: paperless_admin_user
    - secretKey: paperless_ai_jwt_secret
      remoteRef:
        key: paperless_ai_jwt_secret
