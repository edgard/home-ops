---
defaultPodOptions:
  securityContext:
    fsGroup: 1000
    fsGroupChangePolicy: OnRootMismatch
    runAsGroup: 1000
    runAsNonRoot: true
    runAsUser: 1000

controllers:
  atuin:
    type: deployment
    replicas: 1
    strategy: Recreate
    containers:
      app:
        image:
          repository: ghcr.io/atuinsh/atuin
          tag: v18.10.0
        command:
          - atuin
        args:
          - server
          - start
        env:
          ATUIN_DB_URI: sqlite:///config/atuin.db
          ATUIN_HOST: 0.0.0.0
          ATUIN_PORT: "8888"
          ATUIN_OPEN_REGISTRATION: "false"
        ports:
          - name: http
            containerPort: 8888
        probes:
          startup:
            enabled: true
          liveness:
            enabled: true
          readiness:
            enabled: true
        resources:
          requests:
            cpu: 1m
            memory: 1Mi
          limits:
            cpu: "1"
            memory: 1Gi

service:
  atuin:
    controller: atuin
    primary: true
    forceRename: atuin
    labels:
      gatus.edgard.org/enabled: "true"
    ports:
      http:
        port: 8888

route:
  external:
    labels:
      external-dns.edgard.org/scope: external
    parentRefs:
      - name: gateway-external
        namespace: platform-system
        sectionName: https
    hostnames:
      - atuin.edgard.org
    rules:
      - backendRefs:
          - identifier: atuin
            port: 8888
  internal:
    labels:
      external-dns.edgard.org/scope: internal
    parentRefs:
      - name: gateway-internal
        namespace: platform-system
        sectionName: https
    hostnames:
      - atuin.edgard.org
    rules:
      - backendRefs:
          - identifier: atuin
            port: 8888

persistence:
  data:
    type: persistentVolumeClaim
    accessMode: ReadWriteOnce
    size: 2Gi
    advancedMounts:
      atuin:
        app:
          - path: /config
