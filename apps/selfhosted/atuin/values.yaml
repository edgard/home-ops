---
defaultPodOptions:
  securityContext:
    fsGroup: 1000
    fsGroupChangePolicy: OnRootMismatch
    runAsGroup: 1000
    runAsNonRoot: true
    runAsUser: 1000

controllers:
  atuin:
    type: deployment
    replicas: 1
    strategy: Recreate
    containers:
      app:
        image:
          repository: ghcr.io/atuinsh/atuin
          tag: v18.10.0
        command:
          - atuin
        args:
          - server
          - start
        env:
          ATUIN_DB_URI: sqlite:///config/atuin.db
          ATUIN_HOST: 0.0.0.0
          ATUIN_PORT: "8888"
          ATUIN_OPEN_REGISTRATION: "false"
        ports:
          - name: http
            containerPort: 8888
        probes:
          startup:
            enabled: true
          liveness:
            enabled: true
          readiness:
            enabled: true
        resources:
          limits: null
          requests: null

service:
  atuin:
    controller: atuin
    primary: true
    forceRename: atuin
    annotations:
      gatus.edgard.org/enabled: "true"
    ports:
      http:
        port: 8888

route:
  main:
    parentRefs:
      - name: gateway
        namespace: platform-system
        sectionName: https
    hostnames:
      - atuin.edgard.org
    rules:
      - backendRefs:
          - identifier: atuin
            port: 8888

persistence:
  data:
    type: persistentVolumeClaim
    accessMode: ReadWriteOnce
    size: 2Gi
    advancedMounts:
      atuin:
        app:
          - path: /config
