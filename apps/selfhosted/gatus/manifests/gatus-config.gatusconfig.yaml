---
apiVersion: homelab.edgard.org/v1alpha1
kind: GatusConfig
metadata:
  name: gatus-config
  namespace: selfhosted
spec:
  base:
    metrics: false
    ui:
      title: Homelab Status
      description: Real-time health for homelab services.
      header: Homelab
      dark-mode: true
      default-sort-by: group
    storage:
      type: sqlite
      path: /data/gatus.db
    connectivity:
      checker:
        target: 1.1.1.1:53
        interval: 30s
    alerting:
      telegram:
        token: ${GATUS_TELEGRAM_TOKEN}
        id: ${GATUS_TELEGRAM_CHAT_ID}
        parse-mode: Markdown
      default-alert:
        enabled: true
        description: Endpoint is down
        send-on-resolved: true
        failure-threshold: 3
        success-threshold: 2
    endpoints:
      - name: dns-edgard-cloudflare
        group: 01-dns
        url: 1.1.1.1
        dns:
          query-name: edgard.org
          query-type: A
        labels:
          namespace: network
          scope: external
        interval: 1m
        conditions:
          - "[DNS_RCODE] == NOERROR"
      - name: dns-edgard-google
        group: 01-dns
        url: 8.8.8.8
        dns:
          query-name: edgard.org
          query-type: A
        labels:
          namespace: network
          scope: external
        interval: 1m
        conditions:
          - "[DNS_RCODE] == NOERROR"
      - name: ping-google
        group: 02-connectivity
        url: icmp://www.google.com
        labels:
          namespace: network
          scope: external
        interval: 1m
        conditions:
          - "[CONNECTED] == true"
      - name: ping-microsoft
        group: 02-connectivity
        url: icmp://www.microsoft.com
        labels:
          namespace: network
          scope: external
        interval: 1m
        conditions:
          - "[CONNECTED] == true"
      - name: ping-amazon
        group: 02-connectivity
        url: icmp://www.amazon.com
        labels:
          namespace: network
          scope: external
        interval: 1m
        conditions:
          - "[CONNECTED] == true"
      - name: gateway
        group: 03-gateway
        url: tcp://gateway-istio.platform-system.svc.cluster.local:443
        labels:
          namespace: platform-system
        interval: 30s
        conditions:
          - "[CONNECTED] == true"
      - name: gateway-https
        group: 03-gateway
        url: https://dash.edgard.org/
        labels:
          namespace: platform-system
        interval: 1m
        conditions:
          - "[STATUS] >= 200"
          - "[STATUS] < 400"
          - "[CERTIFICATE_EXPIRATION] > 168h"
