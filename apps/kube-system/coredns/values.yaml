---
controllers: {}

configMaps:
  # Create the custom ConfigMap that k3s CoreDNS automatically mounts
  custom:
    enabled: true
    forceRename: coredns-custom
    data:
      # This file ends with .server so it will be imported by "import /etc/coredns/custom/*.server"
      # at the top level of the Corefile (outside the main server block)
      # Hairpin DNS: forward edgard.org queries to k8s-gateway which watches HTTPRoutes
      # and resolves them to the gateway's internal ClusterIP (from gateway.status.addresses)
      # Falls through to Unifi (192.168.1.1) for subdomains without HTTPRoutes
      edgard.server: |-
        edgard.org:53 {
            errors
            forward . k8s-gateway.kube-system.svc.cluster.local 192.168.1.1 {
                policy sequential
            }
            cache 30
            log
        }
