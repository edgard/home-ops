---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: paperless-ai-secret
  namespace: edge-services
spec:
  refreshInterval: 5m
  secretStoreRef:
    name: cluster-secrets-store
    kind: ClusterSecretStore
  target:
    name: paperless-ai-secret
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        # .env file content (for file mount)
        .env: |
          PAPERLESS_API_URL=http://paperless.edge-services.svc.cluster.local:8000/api
          PAPERLESS_API_TOKEN={{ .paperless_api_token }}
          PAPERLESS_USERNAME={{ .paperless_admin_user }}
          AI_PROVIDER=custom
          CUSTOM_BASE_URL=https://openrouter.ai/api/v1
          CUSTOM_API_KEY={{ .paperless_ai_openai_api_key }}
          CUSTOM_MODEL=anthropic/claude-sonnet-4.5
          TOKEN_LIMIT=128000
          RESPONSE_TOKENS=1000
          DISABLE_AUTOMATIC_PROCESSING=no
          SCAN_INTERVAL=5 2 * * *
          ADD_AI_PROCESSED_TAG=no
          ACTIVATE_TAGGING=yes
          ACTIVATE_CORRESPONDENTS=yes
          ACTIVATE_DOCUMENT_TYPE=yes
          ACTIVATE_TITLE=yes
          ACTIVATE_CUSTOM_FIELDS=no
          CUSTOM_FIELDS={"custom_fields":[]}
          RESTRICT_TO_EXISTING_TAGS=yes
          RESTRICT_TO_EXISTING_CORRESPONDENTS=no
          RESTRICT_TO_EXISTING_DOCUMENT_TYPES=no
          USE_EXISTING_DATA=no
          PROCESS_PREDEFINED_DOCUMENTS=no
          SYSTEM_PROMPT=You are a document analysis AI for a multilingual user (English, Portuguese-BR, Polish). AVAILABLE TAGS (use ONLY these English tags): bank-statement, contract, employment, government, housing, insurance, invoice, legal, medical, payslip, receipt, shopping, subscription, tax, travel, user-manual, utilities. RULES: 1) Select tags ONLY from the list above - do NOT translate or create new tags. 2) For correspondents, use official/international company name. 3) Document_type must be in English (Invoice, Contract, Receipt, Letter, Bank Statement, etc). 4) Title: concise, in the ORIGINAL document language. 5) Dates: convert to YYYY-MM-DD format.
          RAG_SERVICE_URL=http://localhost:8000
          RAG_SERVICE_ENABLED=true
          PAPERLESS_AI_INITIAL_SETUP=yes
        # Individual env vars (for envFrom)
        PAPERLESS_API_URL: http://paperless.edge-services.svc.cluster.local:8000/api
        PAPERLESS_API_TOKEN: "{{ .paperless_api_token }}"
        PAPERLESS_USERNAME: "{{ .paperless_admin_user }}"
        AI_PROVIDER: custom
        CUSTOM_BASE_URL: https://openrouter.ai/api/v1
        CUSTOM_API_KEY: "{{ .paperless_ai_openai_api_key }}"
        CUSTOM_MODEL: anthropic/claude-sonnet-4.5
        TOKEN_LIMIT: "128000"
        RESPONSE_TOKENS: "1000"
        DISABLE_AUTOMATIC_PROCESSING: "no"
        SCAN_INTERVAL: 5 2 * * *
        ADD_AI_PROCESSED_TAG: "no"
        ACTIVATE_TAGGING: "yes"
        ACTIVATE_CORRESPONDENTS: "yes"
        ACTIVATE_DOCUMENT_TYPE: "yes"
        ACTIVATE_TITLE: "yes"
        ACTIVATE_CUSTOM_FIELDS: "no"
        CUSTOM_FIELDS: '{"custom_fields":[]}'
        RESTRICT_TO_EXISTING_TAGS: "yes"
        RESTRICT_TO_EXISTING_CORRESPONDENTS: "no"
        RESTRICT_TO_EXISTING_DOCUMENT_TYPES: "no"
        USE_EXISTING_DATA: "no"
        PROCESS_PREDEFINED_DOCUMENTS: "no"
        SYSTEM_PROMPT: "You are a document analysis AI for a multilingual user (English, Portuguese-BR, Polish). AVAILABLE TAGS (use ONLY these English tags): bank-statement, contract, employment, government, housing, insurance, invoice, legal, medical, payslip, receipt, shopping, subscription, tax, travel, user-manual, utilities. RULES: 1) Select tags ONLY from the list above - do NOT translate or create new tags. 2) For correspondents, use official/international company name. 3) Document_type must be in English (Invoice, Contract, Receipt, Letter, Bank Statement, etc). 4) Title: concise, in the ORIGINAL document language. 5) Dates: convert to YYYY-MM-DD format."
        RAG_SERVICE_URL: http://localhost:8000
        RAG_SERVICE_ENABLED: "true"
        PAPERLESS_AI_INITIAL_SETUP: "yes"
  data:
    - secretKey: paperless_api_token
      remoteRef:
        key: cluster-secrets
        property: paperless_api_token
    - secretKey: paperless_ai_openai_api_key
      remoteRef:
        key: cluster-secrets
        property: paperless_ai_openai_api_key
    - secretKey: paperless_admin_user
      remoteRef:
        key: cluster-secrets
        property: paperless_admin_user
