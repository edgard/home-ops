---
apiVersion: homelab.edgard.org/v1alpha1
kind: DexConfig
metadata:
  name: dex-config
  namespace: platform-system
  labels:
    app.kubernetes.io/name: dex-config
    app.kubernetes.io/part-of: dex
spec:
  base:
    issuer: https://id.edgard.org
    storage:
      type: sqlite3
      config:
        file: /data/dex.db
    web:
      http: 0.0.0.0:5556
    telemetry:
      http: 0.0.0.0:5558
    logger:
      level: info
    frontend:
      issuer: Homelab Identity
    oauth2:
      skipApprovalScreen: true
    enablePasswordDB: true
    staticPasswords:
      - email: castro@edgard.org
        username: edgard
        hashFromEnv: DEX_STATIC_PASSWORD_ADMIN_HASH
    staticClients:
      - id: envoy-gateway
        name: Envoy Gateway
        redirectURIs: []
        secretEnv: ENVOY_GATEWAY_CLIENT_SECRET
  outputConfigMap: dex-config-generated
  outputKey: config.yaml
  resyncSeconds: 120
